<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vandan ‚Äî Receipt Generator</title>

<!-- jsPDF + html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root {
    --brand: #8a3422;
    --soft: #fdeceb;
    --muted: #667081;
    --card-bg: #ffffff;
  }

  html,body { height:100%; }
  body {
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    background: linear-gradient(180deg, rgba(138,52,34,0.03), rgba(255,255,255,0));
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:20px;
    box-sizing:border-box;
  }

  .panel {
    width:100%;
    max-width:520px;
    background: var(--card-bg);
    border-radius:14px;
    box-shadow:0 10px 30px rgba(12,12,12,0.06);
    padding:18px;
    box-sizing:border-box;
  }

  .heading { text-align:center; margin:4px 0 12px; }
  .heading h1 { margin:0; font-size:18px; color:var(--muted); font-weight:600; }

  form label { display:block; margin-top:10px; margin-bottom:6px; font-size:13px; color:#333; font-weight:600; }
  input[type="text"], input[type="date"], input[type="number"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6e6e6; background:#fbfbfb; font-size:15px;
    box-sizing:border-box; outline:none;
  }
  input:focus { box-shadow:0 0 0 4px rgba(138,52,34,0.06); border-color:var(--brand); }

  .btn {
    width:100%; padding:12px; margin-top:16px; border-radius:10px; border:none; background:var(--brand); color:#fff;
    font-weight:600; font-size:15px; cursor:pointer;
  }

  /* --- preview receipt (screen) --- */
  .preview { margin-top:16px; background:#fff; border-radius:12px; padding:18px; box-sizing:border-box; border:1px solid #f0e7e6; }
  .logo-wrap { text-align:center; margin-bottom:6px; }
  .receipt-company { text-align:center; color:var(--brand); font-weight:600; margin:6px 0 2px; font-size:16px; }
  .contact-line { text-align:center; color:var(--muted); font-size:13px; margin-bottom:10px; }
  .divider { height:2px; background:var(--brand); margin:8px 0 12px; opacity:0.18; }

  .receipt-title { text-align:center; color:var(--brand); font-weight:700; margin-bottom:6px; font-size:16px; }
  .receipt-meta { text-align:center; color:#3b4752; font-size:13px; margin-bottom:12px; }

  .card { background:var(--soft); border-radius:12px; padding:12px; border:1px solid rgba(138,52,34,0.14); margin-bottom:12px; }
  .card .label { color:var(--brand); font-size:12px; margin-bottom:6px; font-weight:600; }
  .card .value { font-size:16px; color:#111; font-weight:600; }

  .two-col { display:flex; gap:12px; margin-bottom:14px; }
  .two-col .mini { flex:1; background:#f6f9fc; padding:12px; border-radius:10px; border:1px solid #eaeff3; }
  .mini .label { color:#6b7280; font-size:12px; font-weight:600; }
  .mini .value { font-size:15px; margin-top:6px; color:#111; font-weight:600; }

  .amounts { margin-top:6px; padding-top:8px; border-top:1px solid #f4dcd9; }
  .amount-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; font-size:15px; }
  .amount-row .amount-value { font-weight:700; color:#111; }
  .amount-row .green { color:#0b9c34; }
  .amount-row .red { color:#d00000; }

  .footer-note { text-align:center; margin-top:10px; color:#c5413b; font-size:12px; }

  @media (max-width:420px){
    .two-col { flex-direction:column; }
    .panel { padding:14px; }
    .receipt-company { font-size:15px; }
    .receipt-title { font-size:15px; }
  }
</style>
</head>
<body>
  <div class="panel" role="main">
    <div class="heading"><h1>Vandan ‚Äî Receipt Generator</h1></div>

    <form id="receiptForm" onsubmit="return false;">
      <label for="name">Customer Name</label>
      <input id="name" type="text" placeholder="e.g. Rajesh Kumar Sharma" required />

      <label for="phone">Contact Number</label>
      <input id="phone" type="text" placeholder="+91 98765 43210" required />

      <label for="city">City</label>
      <input id="city" type="text" placeholder="Mumbai" required />

      <label for="pooja">Pooja Type</label>
      <input id="pooja" type="text" placeholder="Satyanarayan Pooja" required />

      <label for="date">Pooja Date</label>
      <input id="date" type="date" required />

      <label for="total">Total Amount (‚Çπ)</label>
      <input id="total" type="number" required />

      <label for="advance">Advance Received (‚Çπ)</label>
      <input id="advance" type="number" required />

      <button type="button" class="btn" id="downloadBtn">Download PDF</button>
    </form>

    <!-- On-screen preview (matches screenshot look) -->
    <div class="preview" aria-hidden="true" id="previewArea" >
      <div class="logo-wrap">
        <!-- Inline SVG placeholder logo (works offline/file://) -->
        <img src="logo.png" style="height:50px; object-fit:contain;" />
      </div>

      <div class="receipt-company">Vandan Holy Services Private Limited</div>
      <div class="contact-line">üìû 8104030300 &nbsp; </br> &nbsp; ‚úâÔ∏è ops@vandanpandit.com</div>

      <div class="divider" role="separator"></div>

      <div class="receipt-title">BOOKING RECEIPT</div>
      <div class="receipt-meta" id="metaPreview">Receipt No: VDN-2024-001234<br/>Date: <span id="datePreview"></span></div>

      <div class="card">
        <div class="label">Customer Name</div>
        <div class="value" id="pv_name">‚Äî</div>
      </div>

      <div class="two-col">
        <div class="mini">
          <div class="label">Contact Number</div>
          <div class="value" id="pv_phone">‚Äî</div>
        </div>
        <div class="mini">
          <div class="label">City</div>
          <div class="value" id="pv_city">‚Äî</div>
        </div>
      </div>

      <div class="card">
        <div class="label">Pooja</div>
        <div class="value" id="pv_pooja">‚Äî</div>
        <div style="margin-top:8px; color:var(--brand); font-weight:700; font-size:12px;">üìÖ Scheduled Date</div>
        <div style="font-size:15px; margin-top:6px;" id="pv_date">‚Äî</div>
      </div>

      <div class="amounts">
        <div class="amount-row"><div>Total Amount:</div><div class="amount-value">‚Çπ <span id="pv_total">0</span></div></div>
        <div class="amount-row"><div>Advance Received:</div><div class="amount-value green">‚Çπ <span id="pv_advance">0</span></div></div>
        <div style="height:8px"></div>
        <div class="amount-row"><div>Pending Amount:</div><div class="amount-value red">‚Çπ <span id="pv_pending">0</span></div></div>
        <div class="footer-note">*Pending amount to be paid after pooja</div>
      </div>
    </div>
  </div>

<script>
/* ---------- preview update ---------- */
function formatDateInput(val){
  if(!val) return '';
  const d = new Date(val);
  const opts = { year:'numeric', month:'long', day:'numeric' };
  return d.toLocaleDateString(undefined, opts);
}
function updatePreview(){
  const name = document.getElementById('name').value || '‚Äî';
  const phone = document.getElementById('phone').value || '‚Äî';
  const city = document.getElementById('city').value || '‚Äî';
  const pooja = document.getElementById('pooja').value || '‚Äî';
  const dateVal = document.getElementById('date').value;
  const total = document.getElementById('total').value || 0;
  const advance = document.getElementById('advance').value || 0;

  document.getElementById('pv_name').textContent = name;
  document.getElementById('pv_phone').textContent = phone;
  document.getElementById('pv_city').textContent = city;
  document.getElementById('pv_pooja').textContent = pooja;
  document.getElementById('pv_date').textContent = formatDateInput(dateVal);
  document.getElementById('pv_total').textContent = Number(total).toFixed(2);
  document.getElementById('pv_advance').textContent = Number(advance).toFixed(2);
  document.getElementById('pv_pending').textContent = (Number(total) - Number(advance)).toFixed(2);

  document.getElementById('datePreview').textContent = formatDateInput(new Date().toISOString().slice(0,10));
}
['name','phone','city','pooja','date','total','advance'].forEach(id=>{
  document.getElementById(id).addEventListener('input', updatePreview);
});
updatePreview();

/* ---------- PDF generation (html2canvas + jsPDF) ---------- */
document.getElementById('downloadBtn').addEventListener('click', async function(){
  // read values to ensure preview has latest
  updatePreview();

  // clone preview for PDF rendering at A4-like width (no transforms)
  const preview = document.getElementById('previewArea');
  const clone = preview.cloneNode(true);

  // force A4-like pixel width for crisp rendering. Using 700-760px yields good A4 scaling.
  const pdfRenderWidth = 760; // px width for canvas (A4-like)
  clone.style.width = pdfRenderWidth + "px";
  clone.style.boxSizing = "border-box";
  // place off-screen so it doesn't flash into view
  clone.style.position = "absolute";
  clone.style.left = "-9999px";
  clone.style.top = "0";
  clone.id = "pdfClone";
  document.body.appendChild(clone);

  // high-res scale to avoid blurriness / truncation on mobile
  const devicePR = window.devicePixelRatio || 1;
  // cap scale to reasonable value (2 or 3) to avoid huge memory usage
  const scale = Math.min(2, Math.max(1, devicePR));

  try {
    // html2canvas options
    const canvas = await html2canvas(clone, {
      scale: scale,
      useCORS: false,      // we used inline SVG logo ‚Äî no external images needed
      allowTaint: true,
      logging: false,
      scrollX: 0,
      scrollY: -window.scrollY
    });

    const imgData = canvas.toDataURL("image/png");

    // jsPDF
    const jsPDF = window.jspdf && window.jspdf.jsPDF ? window.jspdf.jsPDF : window.jsPDF;
    const pdf = new jsPDF('p', 'pt', 'a4');
    const pageWidth = pdf.internal.pageSize.getWidth(); // pt
    const margin = 20; // pt
    const imgWidth = pageWidth - margin * 2;
    // convert canvas px -> pdf pts proportionally
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    pdf.addImage(imgData, 'PNG', margin, margin, imgWidth, imgHeight);
    const name = (document.getElementById('name').value || 'receipt').trim().replace(/\s+/g,'_').replace(/[^\w\-_.]/g,'');
    pdf.save(`${name}_receipt.pdf`);

    html2pdf()
        .set({
            margin: 10,
            filename: name + "_Receipt.pdf",
            html2canvas: { scale: 2 },
            jsPDF: { format: "a4", orientation: "portrait" }
        })
        .from(receiptElement)
        .save();
  } catch (err) {
    console.error('PDF generation failed', err);
    alert('Could not generate PDF ‚Äî see console for details.');
  } finally {
    // clean up clone
    clone.remove();
  }
});
</script>
</body>
</html>
